"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const normalize_string_1 = require("@hint/utils/dist/src/misc/normalize-string");
const file_extension_1 = require("@hint/utils/dist/src/fs/file-extension");
const meta_1 = require("./meta");
const i18n_import_1 = require("./i18n.import");
class ManifestFileExtensionHint {
    constructor(context) {
        const standardManifestFileExtension = 'webmanifest';
        const validate = ({ element, resource }) => {
            if (normalize_string_1.normalizeString(element.getAttribute('rel')) === 'manifest') {
                const href = element.resolveUrl(element.getAttribute('href') || '');
                const fileExtension = file_extension_1.fileExtension(normalize_string_1.normalizeString(href) || '');
                if (fileExtension !== standardManifestFileExtension) {
                    let message;
                    if (fileExtension) {
                        message = i18n_import_1.getMessage('shouldHaveFileExtensionNot', context.language, [standardManifestFileExtension, fileExtension]);
                    }
                    else {
                        message = i18n_import_1.getMessage('shouldHaveFileExtension', context.language, standardManifestFileExtension);
                    }
                    context.report(resource, message, { content: fileExtension, element });
                }
            }
        };
        context.on('element::link', validate);
    }
}
exports.default = ManifestFileExtensionHint;
ManifestFileExtensionHint.meta = meta_1.default;
